---
layout: post
title: Writeup - md5 calculator
---

지금까지 pwnable.kr에서 풀어본 문제들 중 점수가 가장 높았고, 그만큼 시간이 많이 걸렸다.

# MD5 Calculator

문제는 다음과 같다.

>We made a simple MD5 calculator as a network service.
>Find a bug and exploit it to get a shell.
>
>Download : http://pwnable.kr/bin/hash
> hint : this service shares the same machine with pwnable.kr web service
> 
>Running at : nc pwnable.kr 9002


## 관찰

nc로 pwnable.kr에 접속해 어떤 일이 일어나는지 관찰해보자.

```
- Welcome to the free MD5 calculating service -  
Are you human? input captcha : 124274294  
>>> 124274294  
Welcome! you are authenticated.  
Encode your data with BASE64 then paste me!  
>>> asdf  
MD5(data) : 97f9d0857f1490352d489b8048da4ac9  
Thank you for using our service.
```
랜덤해보이는 어떤 숫자를 그대로 입력하면 다음 단계로 넘어가고,  base64 형태로 입력을 주면 MD5로 encryption된 결과가 나온다.

이제 hash 바이너리를 받아 IDA로 분석해보자.


![image](https://user-images.githubusercontent.com/27529056/75337402-4a3a5480-58d0-11ea-88a0-e3c8cde8aa44.png)

![image](https://user-images.githubusercontent.com/27529056/75339062-23315200-58d3-11ea-989d-642d5423fe87.png)

captcha 숫자가 사실은 `my_hash()`함수의 결과값이었으며, 이는 `rand()` 함수를 통해 만들어진 난수와 stack canary의 연산을 통해 나온 값임을 알 수 있다. 결과값을 통해 stack canary값을 역추적할 수 있다면 이후 BOF가 가능해질 것이다~
<!--stackedit_data:
eyJoaXN0b3J5IjpbNTQzODQ5OTAyLC0xMTk0MjEyOTA0LC00MD
M3OTQ3MDVdfQ==
-->